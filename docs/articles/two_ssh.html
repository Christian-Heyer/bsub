<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>What if you need to establish two ssh connections to reach the submission node • bsub</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="What if you need to establish two ssh connections to reach the submission node">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bsub</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.99.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/bsub_intro.html">Send R code/R scripts/shell commands to LSF cluster</a>
    </li>
    <li>
      <a href="../articles/dkfz_odcf.html">Use bsub package on the DKFZ ODCF cluster</a>
    </li>
    <li>
      <a href="../articles/other_insititute.html">Configure bsub package for other institutes using LSF</a>
    </li>
    <li>
      <a href="../articles/two_ssh.html">What if you need to establish two ssh connections to reach the submission node</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jokergoo/bsub">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>What if you need to establish two ssh connections to reach the submission node</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jokergoo/bsub/blob/master/vignettes/two_ssh.Rmd"><code>vignettes/two_ssh.Rmd</code></a></small>
      <div class="hidden name"><code>two_ssh.Rmd</code></div>

    </div>

    
    
<p><strong>Author</strong>: Zuguang Gu ( <a href="mailto:z.gu@dkfz.de">z.gu@dkfz.de</a> )</p>
<p><strong>Date</strong>: 2020-02-12</p>
<hr>
<p>For us, if we are outside of DKFZ network, we first connect to DKFZ network by VPN, then we only need one ssh connection to reach the submission node. However, in other institutes, if you are outside of it, you might first need to connect to your institute’s server via ssh (server A), then on server A, you connect to the job submission server, again via ssh (server B), which results in two ssh connections (let’s assume you cannot use <code>bjobs</code> command on server A).</p>
<p>Of course, you cannot establish two nested ssh connections, but we can do some tricks on server A to run a pseudo <code>bjobs</code> which actually runs the real <code>bjobs</code> on server B. Maybe you have already guessed, we need to, on server A, to run <code>bjobs</code> on server B via ssh without interactively entering the password.</p>
<p>The following instructions tell you how to configure <code>bsub_opt</code> so that you can use <strong>bsub</strong> package on your own computer outside your institute’s network.</p>
<ul>
<li>on server A, generate an ssh key so that you can connect from server A to B without entering password interactively.</li>
</ul>
<p>On server A, in the shell:</p>
<pre><code>ssh-keygen</code></pre>
<p>Select where you store the key file (let’s assume it is called <code>~/.ssh/id_rsa</code>).</p>
<p>copy the key to the server B:</p>
<pre><code>ssh-copy-id -i ~/.ssh/id_rsa user@serverB</code></pre>
<p>Test whether you need to enter password if you go from server A to B:</p>
<pre><code>ssh user@serverB</code></pre>
<ul>
<li>If you don’t need to enter the password, on your own computer, use the following configuration:</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">config_foo =<span class="st">  </span><span class="cf">function</span>(<span class="dt">user =</span> <span class="ot">NULL</span>) {</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">    bsub_opt<span class="op">$</span>login_node =<span class="st"> "serverA"</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3">    bsub_opt<span class="op">$</span>submission_node =<span class="st"> </span><span class="ot">NULL</span>  <span class="co"># so that you cannot submit jobs!</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4">    </a>
<a class="sourceLine" id="cb4-5" data-line-number="5">    <span class="cf">if</span>(<span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span>(user)) bsub_opt<span class="op">$</span>user =<span class="st"> </span>user</a>
<a class="sourceLine" id="cb4-6" data-line-number="6"></a>
<a class="sourceLine" id="cb4-7" data-line-number="7">    <span class="co"># you need to find out the value of `LSF_ENVDIR` and `LSF_SERVERDIR` on the submission node</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8">    ssh_envir =<span class="st"> "source /etc/profile; export LSF_ENVDIR=your_LSF_ENVDIR; export LSF_SERVERDIR=your_LSF_SERVERDIR"</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"></a>
<a class="sourceLine" id="cb4-10" data-line-number="10">    <span class="co"># we create pseudo `bjobs`/`bparam`/`bkill` which actually call the real commands on server B</span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11">    bsub_opt<span class="op">$</span>ssh_envir =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(</a>
<a class="sourceLine" id="cb4-12" data-line-number="12">        <span class="st">"source /etc/profile"</span>,</a>
<a class="sourceLine" id="cb4-13" data-line-number="13">        <span class="kw">qq</span>(<span class="st">"alias bjobs=</span><span class="ch">\"</span><span class="st">ssh -i your_ssh_key @{bsub_opt$user}@serverB '@{ssh_envir};bjobs'</span><span class="ch">\"</span><span class="st">"</span>),</a>
<a class="sourceLine" id="cb4-14" data-line-number="14">        <span class="kw">qq</span>(<span class="st">"alias bparam=</span><span class="ch">\"</span><span class="st">ssh -i your_ssh_key @{bsub_opt$user}@serverB '@{ssh_envir};bparam'</span><span class="ch">\"</span><span class="st">"</span>),</a>
<a class="sourceLine" id="cb4-15" data-line-number="15">        <span class="kw">qq</span>(<span class="st">"alias bkill=</span><span class="ch">\"</span><span class="st">ssh -i your_ssh_key @{bsub_opt$user}@serverB '@{ssh_envir};bkill'</span><span class="ch">\"</span><span class="st">"</span>)</a>
<a class="sourceLine" id="cb4-16" data-line-number="16">    )</a>
<a class="sourceLine" id="cb4-17" data-line-number="17">    <span class="kw"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span>(<span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb4-18" data-line-number="18">}</a>
<a class="sourceLine" id="cb4-19" data-line-number="19"><span class="kw">config_foo</span>(<span class="st">"your-user-name"</span>)</a></code></pre></div>
<p>Now you can query job status with <strong>bsub</strong> from command line (by <code><a href="../reference/bjobs.html">bjobs()</a></code>/<code><a href="../reference/brecent.html">brecent()</a></code>/…) or with the interactive job monitor (by <code><a href="../reference/monitor.html">monitor()</a></code>).</p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Zuguang Gu.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
