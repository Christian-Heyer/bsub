<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>What if you need to establish two ssh connections to reach the submission node • bsub</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="What if you need to establish two ssh connections to reach the submission node">
<meta property="og:description" content="bsub">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bsub</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/bsub_intro.html">Send R code/R scripts/shell commands to LSF cluster</a>
    </li>
    <li>
      <a href="../articles/configure_bsub_package.html">Configure bsub package</a>
    </li>
    <li>
      <a href="../articles/two_ssh.html">What if you need to establish two ssh connections to reach the submission node</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jokergoo/bsub/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="two_ssh_files/header-attrs-2.1/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>What if you need to establish two ssh connections to reach the submission node</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jokergoo/bsub/blob/master/vignettes/two_ssh.Rmd"><code>vignettes/two_ssh.Rmd</code></a></small>
      <div class="hidden name"><code>two_ssh.Rmd</code></div>

    </div>

    
    
<p><strong>Author</strong>: Zuguang Gu ( <a href="mailto:z.gu@dkfz.de" class="email">z.gu@dkfz.de</a> )</p>
<p><strong>Date</strong>: 2020-05-30</p>
<hr>
<p>For us, if we are outside of DKFZ network, we first connect to DKFZ network by VPN, then we only need one ssh connection to reach the submission node. However, in some other institutes, if you are outside of network of your institute, you might first need to connect to your institute’s server via ssh (server A), then on server A, you connect to the job submission server, again via ssh (server B), which results in two ssh connections.</p>
<p>Of course, you cannot establish two nested ssh connections, but we can do some tricks on server A to run a pseudo <code>bjobs</code> which actually runs the real <code>bjobs</code> on server B. Maybe you have already guessed, we need to, on server A, run <code>bjobs</code> on server B via ssh without interactively entering the password.</p>
<p><strong>Note since you are not under the same network as the submission node, you cannot submit jobs, however, you can query the job status by functions like <code>bjobs</code>, <code>brecent</code> or <code><a href="../reference/monitor.html">monitor()</a></code>.</strong></p>
<p>The following instructions tell you how to configure <code>bsub_opt</code> so that you can use <strong>bsub</strong> package on your own computer outside your institute’s network.</p>
<p><strong>Step 1:</strong> on server A, generate an ssh key so that you can connect from server A to B without entering password interactively.</p>
<p>On server A, in the shell:</p>
<pre><code>ssh-keygen</code></pre>
<p>Select where you store the key file (let’s assume it is <code>~/.ssh/id_rsa</code>). Copy the key to the server B:</p>
<pre><code>ssh-copy-id -i ~/.ssh/id_rsa user@serverB</code></pre>
<p>Test whether you need to enter password if you go from server A to B:</p>
<pre><code>ssh user@serverB</code></pre>
<p><strong>Step 2:</strong> On your own computer, use the following configuration. Note here we set the <code>login_node</code> while not <code>submission_node</code> because the submission node is not your login node.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">config_foo</span> <span class="kw">=</span>  <span class="kw">function</span>(<span class="no">user</span> <span class="kw">=</span> <span class="kw">NULL</span>) {
    <span class="no">bsub_opt</span>$<span class="no">login_node</span> <span class="kw">=</span> <span class="st">"serverA"</span>
    <span class="no">bsub_opt</span>$<span class="no">submission_node</span> <span class="kw">=</span> <span class="kw">NULL</span>  <span class="co"># so that you cannot submit jobs!</span>

    <span class="kw">if</span>(!<span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span>(<span class="no">user</span>)) <span class="no">bsub_opt</span>$<span class="no">user</span> <span class="kw">=</span> <span class="no">user</span>

    <span class="co"># You need to find out the value of `LSF_ENVDIR` and `LSF_SERVERDIR` on the submission node.</span>
    <span class="co"># Check the "Bash environment" section in ./configure_bsub_package.html</span>
    <span class="no">ssh_envir</span> <span class="kw">=</span> <span class="st">"source /etc/profile; export LSF_ENVDIR=your_LSF_ENVDIR; export LSF_SERVERDIR=your_LSF_SERVERDIR"</span>

    <span class="co"># We create pseudo `bjobs`/`bparam`/`bkill` which actually call the real commands on server B</span>
    <span class="no">bsub_opt</span>$<span class="no">ssh_envir</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(
        <span class="st">"source /etc/profile"</span>,
        <span class="fu">qq</span>(<span class="st">"alias bjobs=\"ssh -i your_ssh_key @{bsub_opt$user}@serverB '@{ssh_envir};bjobs'\""</span>),
        <span class="fu">qq</span>(<span class="st">"alias bparam=\"ssh -i your_ssh_key @{bsub_opt$user}@serverB '@{ssh_envir};bparam'\""</span>),
        <span class="fu">qq</span>(<span class="st">"alias bkill=\"ssh -i your_ssh_key @{bsub_opt$user}@serverB '@{ssh_envir};bkill'\""</span>)
    )
    <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span>(<span class="kw">NULL</span>)
}
<span class="fu">config_foo</span>(<span class="st">"your-user-name"</span>)</pre></body></html></div>
<p>Now you can query job status with <strong>bsub</strong> package from command-line (by <code><a href="../reference/bjobs.html">bjobs()</a></code>/<code><a href="../reference/brecent.html">brecent()</a></code>/…) or with the interactive job monitor (by <code><a href="../reference/monitor.html">monitor()</a></code>).</p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Zuguang Gu.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
