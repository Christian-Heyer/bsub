<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title> â€¢ bsub</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bsub</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/bsub_intro.html">UNKNOWN TITLE</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1></h1>
            
      
      
      <div class="hidden name"><code>bsub_intro.Rmd</code></div>

    </div>

    
    
<!--
%\VignetteEngine{knitr}
%\VignetteIndexEntry{Send R code/R scripts/shell commands to LSF cluster}
-->
<div id="send-r-coder-scriptsshell-commands-to-lsf-cluster" class="section level1">
<h1 class="hasAnchor">
<a href="#send-r-coder-scriptsshell-commands-to-lsf-cluster" class="anchor"></a>Send R code/R scripts/shell commands to LSF cluster</h1>
<p><strong>Author</strong>: Zuguang Gu ( <a href="mailto:z.gu@dkfz.de">z.gu@dkfz.de</a> )</p>
<p><strong>Date</strong>: 2019-12-05</p>
<hr>
<p>Load the library:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(bsub)</a></code></pre></div>
<p><strong>The <em>bsub</em> package works on the submission nodes, the computing nodes and the Rstudio node.</strong></p>
<p><strong>If the current node is not the submission node, a connection via ssh is automatically established. You might be asked to enter password for the connection.</strong></p>
<div id="send-r-code" class="section level2">
<h2 class="hasAnchor">
<a href="#send-r-code" class="anchor"></a>Send R code</h2>
<p>The code chunk should be embraced by <code>{...}</code>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="../reference/bsub_chunk.html">bsub_chunk</a></span>(</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">{</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">    NMF<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/NMF/man/nmf.html">nmf</a></span>(...)</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">})</a></code></pre></div>
<p>In following examples, we use <code><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep(5)</a></code> to simulate a chunk of code which runs for a short time.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw"><a href="../reference/bsub_chunk.html">bsub_chunk</a></span>(</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">{</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">    <span class="kw"><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep</a></span>(<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">})</a></code></pre></div>
<pre><code>## - job: 'R_code_c3481a47' from a code chunk
## bsub -J 'R_code_c3481a47' -W '1:00' -n 1 -R 'rusage[mem=1024]' -o '/home/guz/.bsub_temp/R_code_c3481a47.out' '/home/guz/.bsub_temp/R_code_c3481a47_348762a5a6f1.sh'</code></pre>
<pre><code>## [1] "2272227"</code></pre>
<p>The value returned by <code><a href="../reference/bsub_chunk.html">bsub_chunk()</a></code> is the job ID from LSF cluster.</p>
<div id="job-settings" class="section level3">
<h3 class="hasAnchor">
<a href="#job-settings" class="anchor"></a>Job settings</h3>
<p>Set job name, memory, running time and number of cores:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw"><a href="../reference/bsub_chunk.html">bsub_chunk</a></span>(<span class="dt">name =</span> <span class="st">"example"</span>, <span class="dt">memory =</span> <span class="dv">10</span>, <span class="dt">hour =</span> <span class="dv">10</span>, <span class="dt">core =</span> <span class="dv">4</span>, </a>
<a class="sourceLine" id="cb6-2" data-line-number="2">{</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">    <span class="kw"><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep</a></span>(<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">})</a></code></pre></div>
<pre><code>## - job: 'example' from a code chunk
## bsub -J 'example' -W '10:00' -n 4 -R 'rusage[mem=10240]' -o '/home/guz/.bsub_temp/example.out' '/home/guz/.bsub_temp/example_348738a08aea.sh'</code></pre>
<pre><code>## [1] "2272228"</code></pre>
<p>If <code>name</code> is not specified, an internal name calculated by <code><a href="https://rdrr.io/pkg/digest/man/digest.html">digest::digest()</a></code> on the chunk is automatically assigned. The unit of <code>memory</code> is GB.</p>
</div>
<div id="r-version" class="section level3">
<h3 class="hasAnchor">
<a href="#r-version" class="anchor"></a>R version</h3>
<p>The R version can be specified by <code>R_version</code> argument.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw"><a href="../reference/bsub_chunk.html">bsub_chunk</a></span>(<span class="dt">name =</span> <span class="st">"example"</span>, <span class="dt">R_version =</span> <span class="st">"3.6.0"</span>,</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">{</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">    <span class="kw"><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep</a></span>(<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb9-4" data-line-number="4">})</a></code></pre></div>
<p><code>R_version</code> can be set as a global parameter:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">bsub_opt<span class="op">$</span>R_version =<span class="st"> "3.6.0"</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="kw"><a href="../reference/bsub_chunk.html">bsub_chunk</a></span>(<span class="dt">name =</span> <span class="st">"example"</span>, </a>
<a class="sourceLine" id="cb10-3" data-line-number="3">{</a>
<a class="sourceLine" id="cb10-4" data-line-number="4">    <span class="kw"><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep</a></span>(<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb10-5" data-line-number="5">})</a></code></pre></div>
<p>The R version is used for finding proper <code>Rscript</code> binary. More generally, <code>bsub_opt$call_Rscript</code> is set as a function which returns the calling of <code>Rscript</code>. Also you can initialize other bash environment variables there. The default is:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="cf">function</span>(version) {</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">    <span class="kw">qq</span>(<span class="st">"module load gcc/7.2.0; module load java/1.8.0_131; module load R/@{version}; Rscript"</span>)</a>
<a class="sourceLine" id="cb11-3" data-line-number="3">}</a></code></pre></div>
<p>where <code>version</code> is the value set in <code>bsub_opt$R_version</code>. <code><a href="https://rdrr.io/pkg/GetoptLong/man/qq.html">qq()</a></code> is from <em>GetoptLong</em> package which does <a href="https://en.wikipedia.org/wiki/String_interpolation">variable interpolation</a>.</p>
<p>The module loading for <code>gcc/7.2.0</code> and <code>java/1.8.0_131</code> ensures that R packages depending on specific C/Java libraries can be successfully loaded.</p>
</div>
<div id="bash-environment" class="section level3">
<h3 class="hasAnchor">
<a href="#bash-environment" class="anchor"></a>Bash environment</h3>
<p>In previous example, we load the <code>gcc/7.2.0</code> and <code>java/1.8.0_131</code> modules when loading R. These bash-level module initialization can also be set by <code>sh_head</code> which adds shell commands as header in the bash script that is used for job submission. E.g. to load R 3.6.0, we can do the other way:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">bsub_opt<span class="op">$</span>call_Rscript =<span class="st"> </span><span class="cf">function</span>(version) <span class="kw">qq</span>(<span class="st">"module load R/@{version}; Rscript"</span>)</a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="kw"><a href="../reference/bsub_chunk.html">bsub_chunk</a></span>(<span class="dt">name =</span> <span class="st">"example"</span>, <span class="dt">sh_head =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"module load gcc/7.2.0"</span>, <span class="st">"module load java/1.8.0_131"</span>),</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">{</a>
<a class="sourceLine" id="cb12-4" data-line-number="4">    <span class="kw"><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep</a></span>(<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb12-5" data-line-number="5">})</a></code></pre></div>
<p>Or set <code>sh_head</code> as a global option:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">bsub_opt<span class="op">$</span>call_Rscript =<span class="st"> </span><span class="cf">function</span>(version) <span class="kw">qq</span>(<span class="st">"module load R/@{version}; Rscript"</span>)</a>
<a class="sourceLine" id="cb13-2" data-line-number="2">bsub_opt<span class="op">$</span>sh_head =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"module load gcc/7.2.0"</span>, <span class="st">"module load java/1.8.0_131"</span>)</a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="kw"><a href="../reference/bsub_chunk.html">bsub_chunk</a></span>(<span class="dt">name =</span> <span class="st">"example"</span>,</a>
<a class="sourceLine" id="cb13-4" data-line-number="4">{</a>
<a class="sourceLine" id="cb13-5" data-line-number="5">    <span class="kw"><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep</a></span>(<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb13-6" data-line-number="6">})</a></code></pre></div>
<p>One usage of this functionality is to load <code>pandoc</code> module if the <code>rmarkdown</code> is used in the code chunk:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw"><a href="../reference/bsub_chunk.html">bsub_chunk</a></span>(<span class="dt">name =</span> <span class="st">"example"</span>, <span class="dt">sh_head =</span> <span class="st">"module load pandoc/2.2.1"</span>,</a>
<a class="sourceLine" id="cb14-2" data-line-number="2">{</a>
<a class="sourceLine" id="cb14-3" data-line-number="3">    <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(rmarkdown)</a>
<a class="sourceLine" id="cb14-4" data-line-number="4">    <span class="kw"><a href="https://rdrr.io/pkg/rmarkdown/man/render.html">render</a></span>(...)</a>
<a class="sourceLine" id="cb14-5" data-line-number="5">})</a></code></pre></div>
</div>
<div id="load-other-packages" class="section level3">
<h3 class="hasAnchor">
<a href="#load-other-packages" class="anchor"></a>Load other packages</h3>
<p>The packages that are needed can be directly added in the code chunk:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw"><a href="../reference/bsub_chunk.html">bsub_chunk</a></span>(<span class="dt">name =</span> <span class="st">"example"</span>,</a>
<a class="sourceLine" id="cb15-2" data-line-number="2">{</a>
<a class="sourceLine" id="cb15-3" data-line-number="3">    <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(package1)</a>
<a class="sourceLine" id="cb15-4" data-line-number="4">    <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(package2)</a>
<a class="sourceLine" id="cb15-5" data-line-number="5">    <span class="kw"><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep</a></span>(<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb15-6" data-line-number="6">})</a></code></pre></div>
<p>Or assign by <code>packages</code> argument:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw"><a href="../reference/bsub_chunk.html">bsub_chunk</a></span>(<span class="dt">name =</span> <span class="st">"example"</span>, <span class="dt">packages =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"package1"</span>, <span class="st">"package2"</span>),</a>
<a class="sourceLine" id="cb16-2" data-line-number="2">{</a>
<a class="sourceLine" id="cb16-3" data-line-number="3">    <span class="kw"><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep</a></span>(<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb16-4" data-line-number="4">})</a></code></pre></div>
<p>Or set it as a global parameter:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">bsub_opt<span class="op">$</span>packages =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"package1"</span>, <span class="st">"package2"</span>)</a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="kw"><a href="../reference/bsub_chunk.html">bsub_chunk</a></span>(<span class="dt">name =</span> <span class="st">"example"</span>,</a>
<a class="sourceLine" id="cb17-3" data-line-number="3">{</a>
<a class="sourceLine" id="cb17-4" data-line-number="4">    <span class="kw"><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep</a></span>(<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb17-5" data-line-number="5">})</a></code></pre></div>
</div>
<div id="other-r-variables" class="section level3">
<h3 class="hasAnchor">
<a href="#other-r-variables" class="anchor"></a>Other R variables</h3>
<p>The R variables that are defined outside the code chunk and need to be used inside the code chunk can by specified by <code>variables</code> argument:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">foo =<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="kw"><a href="../reference/bsub_chunk.html">bsub_chunk</a></span>(<span class="dt">name =</span> <span class="st">"example"</span>, <span class="dt">variables =</span> <span class="st">"foo"</span>,</a>
<a class="sourceLine" id="cb18-3" data-line-number="3">{ </a>
<a class="sourceLine" id="cb18-4" data-line-number="4">    bar =<span class="st"> </span>foo</a>
<a class="sourceLine" id="cb18-5" data-line-number="5">    <span class="kw"><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep</a></span>(<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb18-6" data-line-number="6">})</a></code></pre></div>
</div>
<div id="the-workspace-image" class="section level3">
<h3 class="hasAnchor">
<a href="#the-workspace-image" class="anchor"></a>The workspace image</h3>
<p>If you have too many external variables that are used in the code chunk or they are used in multiple jobs, you can directly save the workspace or the objects as an image and specify the <code>image</code> argument:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/save.html">save.image</a></span>(<span class="dt">file =</span> <span class="st">"/path/foo.RData"</span>)</a>
<a class="sourceLine" id="cb19-2" data-line-number="2"><span class="co"># or </span></a>
<a class="sourceLine" id="cb19-3" data-line-number="3"><span class="co"># save(var1, var2, ..., file = "...")</span></a>
<a class="sourceLine" id="cb19-4" data-line-number="4"><span class="kw"><a href="../reference/bsub_chunk.html">bsub_chunk</a></span>(<span class="dt">name =</span> <span class="st">"example"</span>, <span class="dt">image =</span> <span class="st">"/path/foo.RData"</span>,</a>
<a class="sourceLine" id="cb19-5" data-line-number="5">{ </a>
<a class="sourceLine" id="cb19-6" data-line-number="6">    ...</a>
<a class="sourceLine" id="cb19-7" data-line-number="7">    <span class="kw"><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep</a></span>(<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb19-8" data-line-number="8">})</a></code></pre></div>
<p>Or set the image file as a global parameter:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/save.html">save.image</a></span>(<span class="dt">file =</span> <span class="st">"/path/foo.RData"</span>)</a>
<a class="sourceLine" id="cb20-2" data-line-number="2">bsub_opt<span class="op">$</span>image =<span class="st"> "/path/foo.RData"</span></a>
<a class="sourceLine" id="cb20-3" data-line-number="3"><span class="kw"><a href="../reference/bsub_chunk.html">bsub_chunk</a></span>(<span class="dt">name =</span> <span class="st">"example"</span>,</a>
<a class="sourceLine" id="cb20-4" data-line-number="4">{ </a>
<a class="sourceLine" id="cb20-5" data-line-number="5">    ...</a>
<a class="sourceLine" id="cb20-6" data-line-number="6">    <span class="kw"><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep</a></span>(<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb20-7" data-line-number="7">})</a></code></pre></div>
<p>When <code>image</code> is set to <code>TRUE</code>, all variables in <code>.GlobalEnv</code> will be saved into a temporary file and all attached packages will be recorded. The temporary files will be removed after the job is finished.</p>
<p>Absolute paths should be used instead of relative paths.</p>
</div>
<div id="the-working-directory" class="section level3">
<h3 class="hasAnchor">
<a href="#the-working-directory" class="anchor"></a>The working directory</h3>
<p>If the code chunk replies on the working directory, it can be specified by <code>wd</code> argument:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="kw"><a href="../reference/bsub_chunk.html">bsub_chunk</a></span>(<span class="dt">name =</span> <span class="st">"example"</span>, <span class="dt">wd =</span> <span class="st">"/path"</span></a>
<a class="sourceLine" id="cb21-2" data-line-number="2">{ </a>
<a class="sourceLine" id="cb21-3" data-line-number="3">    <span class="kw"><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep</a></span>(<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb21-4" data-line-number="4">})</a></code></pre></div>
<p>Or set it as a global parameter:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1">bsub_opt<span class="op">$</span>wd =<span class="st"> "/path"</span></a>
<a class="sourceLine" id="cb22-2" data-line-number="2"><span class="kw"><a href="../reference/bsub_chunk.html">bsub_chunk</a></span>(<span class="dt">name =</span> <span class="st">"example"</span>,</a>
<a class="sourceLine" id="cb22-3" data-line-number="3">{ </a>
<a class="sourceLine" id="cb22-4" data-line-number="4">    <span class="kw"><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep</a></span>(<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb22-5" data-line-number="5">})</a></code></pre></div>
<p>Absolute path should be used.</p>
</div>
<div id="retrieve-the-last-variable" class="section level3">
<h3 class="hasAnchor">
<a href="#retrieve-the-last-variable" class="anchor"></a>Retrieve the last variable</h3>
<p>The last variable in the code chunk can be saved by setting <code>save_var = TRUE</code> and retrieved back by <code><a href="../reference/retrieve_var.html">retrieve_var()</a></code> by specifying the job name. Since the variable is looked up by the job name, there should be no job with the same name submitted before retrieving the variable.</p>
<p><code><a href="../reference/retrieve_var.html">retrieve_var()</a></code> waits until the job is finished.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="kw"><a href="../reference/bsub_chunk.html">bsub_chunk</a></span>(<span class="dt">name =</span> <span class="st">"example2"</span>, <span class="dt">save_var =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb23-2" data-line-number="2">{</a>
<a class="sourceLine" id="cb23-3" data-line-number="3">    <span class="kw"><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep</a></span>(<span class="dv">10</span>)</a>
<a class="sourceLine" id="cb23-4" data-line-number="4">    <span class="dv">1</span><span class="op">+</span><span class="dv">1</span></a>
<a class="sourceLine" id="cb23-5" data-line-number="5">})</a></code></pre></div>
<pre><code>## - job: 'example2' from a code chunk
## bsub -J 'example2' -W '1:00' -n 1 -R 'rusage[mem=1024]' -o '/home/guz/.bsub_temp/example2.out' '/home/guz/.bsub_temp/example2_3487344647da.sh'</code></pre>
<pre><code>## [1] "2272229"</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="kw"><a href="../reference/retrieve_var.html">retrieve_var</a></span>(<span class="st">"example2"</span>)</a></code></pre></div>
<pre><code>## job is running or pending, retry in 30 seconds.</code></pre>
<pre><code>## [1] 2</code></pre>
<p>However, it is not suggested to directly retrieve the returned value from the code chunk. Better choice is to save the variable into permanent file in the code chunk, E.g.:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="kw"><a href="../reference/bsub_chunk.html">bsub_chunk</a></span>(<span class="dt">name =</span> <span class="st">"example"</span>, </a>
<a class="sourceLine" id="cb29-2" data-line-number="2">{</a>
<a class="sourceLine" id="cb29-3" data-line-number="3">    ...</a>
<a class="sourceLine" id="cb29-4" data-line-number="4">    <span class="kw"><a href="https://rdrr.io/r/base/save.html">save</a></span>(...)</a>
<a class="sourceLine" id="cb29-5" data-line-number="5">    <span class="co"># or</span></a>
<a class="sourceLine" id="cb29-6" data-line-number="6">    <span class="kw"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span>(...)</a>
<a class="sourceLine" id="cb29-7" data-line-number="7">})</a></code></pre></div>
</div>
<div id="rerun-the-job" class="section level3">
<h3 class="hasAnchor">
<a href="#rerun-the-job" class="anchor"></a>Rerun the job</h3>
<p>There is a flag file to mark whether the job was successfully finished or not. If the job has been successfully done, the job with the same name will be skipped. <code>enforce</code> argument controls how to rerun the jobs with the same names. If it is set to <code>TRUE</code>, jobs will be rerun no matter they are done or not.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1"><span class="kw"><a href="../reference/bsub_chunk.html">bsub_chunk</a></span>(<span class="dt">name =</span> <span class="st">"example"</span>, <span class="dt">enforce =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb30-2" data-line-number="2">{ </a>
<a class="sourceLine" id="cb30-3" data-line-number="3">    <span class="kw"><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep</a></span>(<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb30-4" data-line-number="4">})</a></code></pre></div>
<pre><code>## - job: 'example' from a code chunk
## Job 'example' is already done, skip.</code></pre>
<p><code>enforce</code> can be set as a global parameter:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1">bsub_opt<span class="op">$</span>enforce =<span class="st"> </span><span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb32-2" data-line-number="2"><span class="kw"><a href="../reference/bsub_chunk.html">bsub_chunk</a></span>(<span class="dt">name =</span> <span class="st">"example"</span>,</a>
<a class="sourceLine" id="cb32-3" data-line-number="3">{ </a>
<a class="sourceLine" id="cb32-4" data-line-number="4">    <span class="kw"><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep</a></span>(<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb32-5" data-line-number="5">})</a></code></pre></div>
</div>
<div id="job-dependency" class="section level3">
<h3 class="hasAnchor">
<a href="#job-dependency" class="anchor"></a>Job dependency</h3>
<p>Since <code><a href="../reference/bsub_chunk.html">bsub_chunk()</a></code> returns the job ID, it is can be used to specify the dependency in other jobs. The value for <code>dependency</code> can be a vector of job IDs.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1">job1 =<span class="st"> </span><span class="kw"><a href="../reference/bsub_chunk.html">bsub_chunk</a></span>(<span class="dt">name =</span> <span class="st">"example1"</span>,</a>
<a class="sourceLine" id="cb33-2" data-line-number="2">{ </a>
<a class="sourceLine" id="cb33-3" data-line-number="3">    <span class="kw"><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep</a></span>(<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb33-4" data-line-number="4">})</a>
<a class="sourceLine" id="cb33-5" data-line-number="5"><span class="kw"><a href="../reference/bsub_chunk.html">bsub_chunk</a></span>(<span class="dt">name =</span> <span class="st">"example2"</span>, <span class="dt">dependency =</span> job1,</a>
<a class="sourceLine" id="cb33-6" data-line-number="6">{ </a>
<a class="sourceLine" id="cb33-7" data-line-number="7">    <span class="kw"><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep</a></span>(<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb33-8" data-line-number="8">})</a></code></pre></div>
</div>
<div id="temporary-and-output-directory" class="section level3">
<h3 class="hasAnchor">
<a href="#temporary-and-output-directory" class="anchor"></a>Temporary and output directory</h3>
<p><code><a href="../reference/bsub_chunk.html">bsub_chunk()</a></code> has two arguments <code>temp_dir</code> and <code>output_dir</code>. <code>temp_dir</code> is used for the temporary R script and sh files. <code>output_dir</code> is used for the flag files and the output files from LSF cluster.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1"><span class="kw"><a href="../reference/bsub_chunk.html">bsub_chunk</a></span>(<span class="dt">name =</span> <span class="st">"example"</span>, <span class="dt">temp_dir =</span> ..., <span class="dt">output_dir =</span> ...,</a>
<a class="sourceLine" id="cb34-2" data-line-number="2">{ </a>
<a class="sourceLine" id="cb34-3" data-line-number="3">    <span class="kw"><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep</a></span>(<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb34-4" data-line-number="4">})</a></code></pre></div>
<p>They can be set as global parameters. The value of <code>output_dir</code> is by default set as the same as <code>temp_dir</code>.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1">bsub_opt<span class="op">$</span>temp_dir =<span class="st"> </span>...</a>
<a class="sourceLine" id="cb35-2" data-line-number="2">bsub_opt<span class="op">$</span>output_dir =<span class="st"> </span>...</a>
<a class="sourceLine" id="cb35-3" data-line-number="3"><span class="kw"><a href="../reference/bsub_chunk.html">bsub_chunk</a></span>(<span class="dt">name =</span> <span class="st">"example"</span>,</a>
<a class="sourceLine" id="cb35-4" data-line-number="4">{ </a>
<a class="sourceLine" id="cb35-5" data-line-number="5">    <span class="kw"><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep</a></span>(<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb35-6" data-line-number="6">})</a></code></pre></div>
<p>To remove temporary files in <code>temp_dir</code>, run <code><a href="../reference/clear_temp_dir.html">clear_temp_dir()</a></code> function.</p>
</div>
<div id="run-code-chunk-from-a-script" class="section level3">
<h3 class="hasAnchor">
<a href="#run-code-chunk-from-a-script" class="anchor"></a>Run code chunk from a script</h3>
<p>You can run code chunk from a script by specifying the starting line number and the ending line number. The R script is specified by <code>script</code> argument, the starting line number and the ending line number are specified by <code>start</code> and <code>end</code> arguments. (Note this functionality has not been tested yet.)</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1"><span class="kw"><a href="../reference/bsub_chunk.html">bsub_chunk</a></span>(<span class="dt">name =</span> <span class="st">"example"</span>,</a>
<a class="sourceLine" id="cb36-2" data-line-number="2">    <span class="dt">script =</span> <span class="st">"/path/foo.R"</span>,</a>
<a class="sourceLine" id="cb36-3" data-line-number="3">    <span class="dt">start =</span> <span class="dv">10</span>, <span class="dt">end =</span> <span class="dv">20</span>, ...)</a></code></pre></div>
<p>Assume you are editing <code>foo.R</code> very offen and the line numbers that you want to run change from time to time. You can add tags in the R script and specifying <code>start</code> and <code>end</code> by those tags. In following example which is the source code of <code>foo.R</code>, we add tags for the code chunk we want to run:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1">...</a>
<a class="sourceLine" id="cb37-2" data-line-number="2"><span class="co"># BSUB_START</span></a>
<a class="sourceLine" id="cb37-3" data-line-number="3">you code chunk here</a>
<a class="sourceLine" id="cb37-4" data-line-number="4"><span class="co"># BSUB_</span><span class="re">END</span></a>
<a class="sourceLine" id="cb37-5" data-line-number="5">...</a></code></pre></div>
<p>Then you can specify <code>start</code> and <code>end</code> by regular expressions to match them:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" data-line-number="1"><span class="kw"><a href="../reference/bsub_chunk.html">bsub_chunk</a></span>(<span class="dt">name =</span> <span class="st">"example"</span>,</a>
<a class="sourceLine" id="cb38-2" data-line-number="2">    <span class="dt">script =</span> <span class="st">"/path/foo.R"</span>,</a>
<a class="sourceLine" id="cb38-3" data-line-number="3">    <span class="dt">start =</span> <span class="st">"^# BSUB_START"</span>, </a>
<a class="sourceLine" id="cb38-4" data-line-number="4">    <span class="dt">end =</span> <span class="st">"^# BSUB_END"</span>, ...)</a></code></pre></div>
</div>
<div id="run-jobs-locally" class="section level3">
<h3 class="hasAnchor">
<a href="#run-jobs-locally" class="anchor"></a>Run jobs locally</h3>
<p>Setting <code>local = TRUE</code> directly runs the code chunk in the same R session.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1"><span class="kw"><a href="../reference/bsub_chunk.html">bsub_chunk</a></span>(<span class="dt">name =</span> <span class="st">"example"</span>, <span class="dt">local =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb39-2" data-line-number="2">{ </a>
<a class="sourceLine" id="cb39-3" data-line-number="3">    <span class="kw"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="st">"blablabla...</span><span class="ch">\n</span><span class="st">"</span>)</a>
<a class="sourceLine" id="cb39-4" data-line-number="4">})</a></code></pre></div>
<pre><code>## - job: 'example' from a code chunk
## bash /home/guz/.bsub_temp/example_34872e8d6c93.sh</code></pre>
</div>
</div>
<div id="send-r-script" class="section level2">
<h2 class="hasAnchor">
<a href="#send-r-script" class="anchor"></a>Send R script</h2>
<p><code><a href="../reference/bsub_script.html">bsub_script()</a></code> submits the job from R scripts. The major arguments are the same as in <code><a href="../reference/bsub_chunk.html">bsub_chunk()</a></code>.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1"><span class="kw"><a href="../reference/bsub_script.html">bsub_script</a></span>(<span class="st">"/path/foo.R"</span>, <span class="dt">name =</span> ..., <span class="dt">memory =</span> ..., <span class="dt">core =</span> ..., ...)</a></code></pre></div>
<p>If the R script needs command-line arguments, they can be specified by <code>argv</code>.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1"><span class="kw"><a href="../reference/bsub_script.html">bsub_script</a></span>(<span class="st">"/path/foo.R"</span>, <span class="dt">argv =</span> <span class="st">"--a 1 --b 3"</span>, ...)</a></code></pre></div>
<p>The command-line arguments can also specified as arguments of <code><a href="../reference/bsub_script.html">bsub_script()</a></code>, but with <code>.</code> prefix.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" data-line-number="1"><span class="kw"><a href="../reference/bsub_script.html">bsub_script</a></span>(<span class="st">"/path/foo.R"</span>, <span class="dt">.a =</span> <span class="dv">1</span>, <span class="dt">.b =</span> <span class="dv">3</span>, ...)</a></code></pre></div>
<p>The R scripts should be used with the absolute paths.</p>
<p>Note the bash environment can be initialized by setting a <code>sh_head</code>.</p>
</div>
<div id="send-other-shell-commands" class="section level2">
<h2 class="hasAnchor">
<a href="#send-other-shell-commands" class="anchor"></a>Send other shell commands</h2>
<p><code><a href="../reference/bsub_cmd.html">bsub_cmd()</a></code>submits shell commands. Basically it is similar as <code><a href="../reference/bsub_script.html">bsub_script()</a></code>:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" data-line-number="1"><span class="kw"><a href="../reference/bsub_cmd.html">bsub_cmd</a></span>(<span class="st">"samtools sort ..."</span>, <span class="dt">name =</span> ..., <span class="dt">memory =</span> ..., <span class="dt">core =</span> ..., ...)</a>
<a class="sourceLine" id="cb44-2" data-line-number="2"><span class="kw"><a href="../reference/bsub_cmd.html">bsub_cmd</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"cmd1"</span>, <span class="st">"cmd2"</span>, ...), <span class="dt">name =</span> ..., <span class="dt">memory =</span> ..., <span class="dt">core =</span> ..., ...)</a></code></pre></div>
<p>The binary and the arguments should all be set in the first argument of <code><a href="../reference/bsub_cmd.html">bsub_cmd()</a></code>.</p>
</div>
<div id="global-parameters" class="section level2">
<h2 class="hasAnchor">
<a href="#global-parameters" class="anchor"></a>Global Parameters</h2>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" data-line-number="1">bsub_opt</a></code></pre></div>
<pre><code>##           Option                                    Value
##         packages                                     NULL
##            image                                     NULL
##         temp_dir                     /home/guz/.bsub_temp
##       output_dir                     /home/guz/.bsub_temp
##          enforce                                     TRUE
##        R_version                                    3.6.0
##               wd                                       ""
##           ignore                                    FALSE
##            local                                    FALSE
##     call_Rscript                  a user-defined function
##  submission_node odcf-worker01, odcf-cn34u03s10, odcf....
##          sh_head                                       ""
##             user                                      guz
##            group                                       ""
##        ssh_envir source /etc/profile, export LSF_ENVD....
##    bsub_template                  a user-defined function</code></pre>
</div>
<div id="other-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#other-functions" class="anchor"></a>Other functions</h2>
<ul>
<li>
<code><a href="../reference/bjobs.html">bjobs()</a></code> or just entering <code>bjobs</code> gives a summary of running jobs. Job status (by default is <code>RUN</code> and <code>PEND</code>) is controlled by <code>status</code> argument. Number of most recent jobs is controlled by <code>max</code> argument. Filtering on the job name is controlled by <code>filter</code> argument.</li>
<li>
<code><a href="../reference/job_log.html">job_log(job_id)</a></code> prints the log of a specified running/finished/failed job.</li>
<li>
<code><a href="../reference/ssh_connect.html">ssh_connect()</a></code> establishes the SSH connection to the submission node if it is lost.</li>
</ul>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(GetoptLong)</a>
<a class="sourceLine" id="cb47-2" data-line-number="2"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>) {</a>
<a class="sourceLine" id="cb47-3" data-line-number="3">    <span class="kw"><a href="../reference/bsub_chunk.html">bsub_chunk</a></span>(<span class="dt">name =</span> <span class="kw"><a href="https://rdrr.io/pkg/GetoptLong/man/qq.html">qq</a></span>(<span class="st">"example_@{i}"</span>),</a>
<a class="sourceLine" id="cb47-4" data-line-number="4">    { </a>
<a class="sourceLine" id="cb47-5" data-line-number="5">        <span class="kw"><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep</a></span>(<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb47-6" data-line-number="6">    })</a>
<a class="sourceLine" id="cb47-7" data-line-number="7">}</a></code></pre></div>
<pre><code>## - job: 'example_1' from a code chunk
## bsub -J 'example_1' -W '1:00' -n 1 -R 'rusage[mem=1024]' -o '/home/guz/.bsub_temp/example_1.out' '/home/guz/.bsub_temp/example_1_34872ebb2cf4.sh' 
## - job: 'example_2' from a code chunk
## bsub -J 'example_2' -W '1:00' -n 1 -R 'rusage[mem=1024]' -o '/home/guz/.bsub_temp/example_2.out' '/home/guz/.bsub_temp/example_2_348779d5abfe.sh' 
## - job: 'example_3' from a code chunk
## bsub -J 'example_3' -W '1:00' -n 1 -R 'rusage[mem=1024]' -o '/home/guz/.bsub_temp/example_3.out' '/home/guz/.bsub_temp/example_3_3487630bbb1a.sh' 
## - job: 'example_4' from a code chunk
## bsub -J 'example_4' -W '1:00' -n 1 -R 'rusage[mem=1024]' -o '/home/guz/.bsub_temp/example_4.out' '/home/guz/.bsub_temp/example_4_34871b1b3f3a.sh'</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" data-line-number="1">bjobs</a></code></pre></div>
<pre><code>## ============================================================================================================ 
##  JOBID   STAT JOB_NAME                        SUBMIT_TIME         TIME_PASSED TIME_LEFT SLOTS MEM    MAX_MEM
##  2213548 RUN  cola_recount_SRP048759          2019-12-02 19:31:26 19:29       0:30      4     8.3Gb  9.5Gb  
##  2213549 RUN  cola_recount_SRP048801          2019-12-02 19:31:26 19:27       0:32      4     3.3Gb  8Gb    
##  2213552 RUN  cola_recount_SRP049593          2019-12-02 19:31:27 18:46       1:13      4     8.2Gb  8.4Gb  
##  2213557 RUN  cola_recount_SRP050223          2019-12-02 19:31:28 18:10       1:49      4     3.5Gb  8.6Gb  
##  2213561 RUN  cola_recount_SRP050892          2019-12-02 19:31:29 17:46       2:13      4     3.5Gb  8.1Gb  
##  2213562 RUN  cola_recount_SRP050992          2019-12-02 19:31:29 17:42       2:17      4     8.8Gb  8.9Gb  
##  2213567 RUN  cola_recount_SRP051844          2019-12-02 19:31:30 16:55       3:04      4     3.5Gb  9.3Gb  
##  2213568 RUN  cola_recount_SRP051848          2019-12-02 19:31:30 16:51       3:08      4     6.8Gb  6.9Gb  
##  2213569 RUN  cola_recount_SRP052740          2019-12-02 19:31:30 16:49       3:10      4     2.2Gb  6.8Gb  
##  2213572 RUN  cola_recount_SRP055153          2019-12-02 19:31:31 16:32       3:27      4     5Gb    5.8Gb  
##  2213574 RUN  cola_recount_SRP055513          2019-12-02 19:31:32 15:54       4:05      4     5Gb    5.8Gb  
##  2213584 RUN  cola_recount_SRP057196          2019-12-02 19:31:34 14:22       5:37      4     8.2Gb  8.8Gb  
##  2213586 RUN  cola_recount_SRP057500          2019-12-02 19:31:34 14:04       5:55      4     2.9Gb  7.8Gb  
##  2213593 RUN  cola_recount_SRP059039          2019-12-02 19:31:36 12:05       7:54      4     6.5Gb  6.9Gb  
##  2213595 RUN  cola_recount_SRP059172          2019-12-02 19:31:36 11:43       8:16      4     6.1Gb  6.4Gb  
##  2213607 RUN  cola_recount_SRP063496          2019-12-02 19:31:39 8:42        11:17     4     1.7Gb  6.1Gb  
##  2213608 RUN  cola_recount_SRP063840          2019-12-02 19:31:39 8:36        11:23     4     5.7Gb  5.8Gb  
##  2213612 RUN  cola_recount_SRP065812          2019-12-02 19:31:40 7:04        12:55     4     5.3Gb  5.9Gb  
##  2213613 RUN  cola_recount_TCGA_adrenal_gland 2019-12-02 19:31:40 7:02        12:57     4     7.1Gb  7.3Gb  
##  2213614 RUN  cola_recount_TCGA_bladder       2019-12-02 19:31:40 6:46        13:13     4     8.5Gb  8.7Gb  
##  2213615 RUN  cola_recount_TCGA_bone_marrow   2019-12-02 19:31:40 6:45        13:14     4     4.6Gb  11.4Gb 
##  2213616 RUN  cola_recount_TCGA_brain         2019-12-02 19:31:41 6:41        13:18     4     9.6Gb  9.9Gb  
##  2213617 RUN  cola_recount_TCGA_breast        2019-12-02 19:31:41 6:37        13:22     4     7.8Gb  10.5Gb 
##  2213618 RUN  cola_recount_TCGA_cervix        2019-12-02 19:31:41 6:35        13:24     4     4.7Gb  7.7Gb  
##  2213619 RUN  cola_recount_TCGA_colorectal    2019-12-02 19:31:41 6:29        13:30     4     7.9Gb  9.8Gb  
##  2213620 RUN  cola_recount_TCGA_esophagus     2019-12-02 19:31:42 6:08        13:51     4     6.6Gb  7Gb    
##  2213621 RUN  cola_recount_TCGA_eye           2019-12-02 19:31:42 5:54        14:05     4     9.7Gb  9.8Gb  
##  2213622 RUN  cola_recount_TCGA_head_and_neck 2019-12-02 19:31:42 5:50        14:09     4     7.9Gb  9.7Gb  
##  2213623 RUN  cola_recount_TCGA_kidney        2019-12-02 19:31:42 5:21        14:38     4     9.8Gb  10.1Gb 
##  2213624 RUN  cola_recount_TCGA_liver         2019-12-02 19:31:42 5:21        14:38     4     8.7Gb  8.8Gb  
##  2213625 RUN  cola_recount_TCGA_lung          2019-12-02 19:31:43 5:21        14:38     4     10.2Gb 10.2Gb 
##  2213626 RUN  cola_recount_TCGA_ovary         2019-12-02 19:31:43 5:19        14:40     4     8.7Gb  8.7Gb  
##  2213627 RUN  cola_recount_TCGA_pancreas      2019-12-02 19:31:43 4:41        15:18     4     2.9Gb  6.9Gb  
##  2213628 RUN  cola_recount_TCGA_pleura        2019-12-02 19:31:43 4:34        15:25     4     5.1Gb  5.2Gb  
##  2213629 RUN  cola_recount_TCGA_prostate      2019-12-02 19:31:43 4:27        15:32     4     9.6Gb  9.6Gb  
##  2213630 RUN  cola_recount_TCGA_skin          2019-12-02 19:31:44 4:02        15:57     4     9.2Gb  9.3Gb  
##  2213631 RUN  cola_recount_TCGA_soft_tissue   2019-12-02 19:31:44 3:50        16:09     4     7Gb    7.2Gb  
##  2213632 RUN  cola_recount_TCGA_stomach       2019-12-02 19:31:44 3:26        16:33     4     8.9Gb  8.9Gb  
##  2213633 RUN  cola_recount_TCGA_testis        2019-12-02 19:31:44 3:26        16:33     4     6.1Gb  6.4Gb  
##  2213634 RUN  cola_recount_TCGA_thymus        2019-12-02 19:31:45 3:15        16:44     4     5.9Gb  6Gb    
##  2213635 RUN  cola_recount_TCGA_thyroid       2019-12-02 19:31:45 2:43        17:16     4     9.2Gb  9.7Gb  
##  2213636 RUN  cola_recount_TCGA_uterus        2019-12-02 19:31:45 2:42        17:17     4     9.4Gb  9.7Gb  
##  2272231 PEND example_1                       2019-12-05 19:44:28 -           -         -     -      -      
##  2272232 PEND example_2                       2019-12-05 19:44:28 -           -         -     -      -      
##  2272233 PEND example_3                       2019-12-05 19:44:28 -           -         -     -      -      
##  2272234 PEND example_4                       2019-12-05 19:44:28 -           -         -     -      -      
##  JOBID   STAT JOB_NAME                        SUBMIT_TIME         TIME_PASSED TIME_LEFT SLOTS MEM    MAX_MEM
## ============================================================================================================ 
##  422 DONE jobs, 63 EXIT jobs, 4 PEND jobs, 42 RUN jobs within one week.
##  You can have more controls by `bjobs(status = ..., max = ..., filter = ...)`.</code></pre>
<p>There is one additional column <code>RECENT</code> in the summary table which shows the order of the jobs with the same job name. The most recent job has the value 1.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" data-line-number="1"><span class="kw"><a href="../reference/bjobs.html">bjobs</a></span>(<span class="dt">status =</span> <span class="st">"all"</span>, <span class="dt">filter =</span> <span class="st">"example"</span>)</a></code></pre></div>
<pre><code>## ========================================================================================== 
##  JOBID   STAT JOB_NAME  RECENT SUBMIT_TIME         TIME_PASSED TIME_LEFT SLOTS MEM MAX_MEM
##  2190912 DONE example   11     2019-12-01 17:42:01 0:00        -         4     -   6Mb    
##  2190913 DONE example2   9     2019-12-01 17:42:01 0:00        -         1     -   41Mb   
##  2190914 DONE example_1  7     2019-12-01 17:42:43 0:00        -         1     -   37Mb   
##  2190915 DONE example_2  7     2019-12-01 17:42:43 0:00        -         1     -   37Mb   
##  2190916 DONE example_3  7     2019-12-01 17:42:43 0:00        -         1     -   37Mb   
##  2190917 DONE example_4  7     2019-12-01 17:42:43 0:00        -         1     -   37Mb   
##  2198294 DONE example   10     2019-12-02 09:34:25 0:00        -         4     -   16Mb   
##  2198295 DONE example2   8     2019-12-02 09:34:26 0:00        -         1     -   41Mb   
##  2198300 DONE example_1  6     2019-12-02 09:35:07 0:00        -         1     -   41Mb   
##  2198301 DONE example_2  6     2019-12-02 09:35:07 0:00        -         1     -   41Mb   
##  2198302 DONE example_3  6     2019-12-02 09:35:07 0:00        -         1     -   41Mb   
##  2198303 DONE example_4  6     2019-12-02 09:35:07 0:00        -         1     -   41Mb   
##  2212998 DONE example    9     2019-12-02 19:15:02 0:00        -         4     -   28Mb   
##  2213099 DONE example2   7     2019-12-02 19:15:05 0:00        -         1     -   41Mb   
##  2213101 DONE example_1  5     2019-12-02 19:16:16 0:00        -         1     -   37Mb   
##  2213102 DONE example_2  5     2019-12-02 19:16:16 0:00        -         1     -   37Mb   
##  2213103 DONE example_3  5     2019-12-02 19:16:17 0:00        -         1     -   37Mb   
##  2213104 DONE example_4  5     2019-12-02 19:16:17 0:00        -         1     -   17Mb   
##  2218159 DONE example    8     2019-12-03 11:48:24 0:00        -         4     -   37Mb   
##  2218160 DONE example2   6     2019-12-03 11:48:25 0:00        -         1     -   37Mb   
##  2218229 DONE example    7     2019-12-03 11:52:06 0:00        -         1     -   41Mb   
##  2218230 DONE example_1  4     2019-12-03 11:52:08 0:00        -         1     -   41Mb   
##  2218231 DONE example_2  4     2019-12-03 11:52:08 0:00        -         1     -   39Mb   
##  2218232 DONE example_3  4     2019-12-03 11:52:08 0:00        -         1     -   39Mb   
##  2218233 DONE example_4  4     2019-12-03 11:52:08 0:00        -         1     -   41Mb   
##  2230228 DONE example    6     2019-12-04 10:35:24 0:00        -         4     -   41Mb   
##  2230229 DONE example2   5     2019-12-04 10:35:24 0:00        -         1     -   41Mb   
##  2230238 DONE example    5     2019-12-04 10:43:33 0:00        -         4     -   42Mb   
##  2230239 DONE example2   4     2019-12-04 10:43:33 0:00        -         1     -   41Mb   
##  2230247 DONE example    4     2019-12-04 10:49:27 0:00        -         4     -   41Mb   
##  2230248 DONE example2   3     2019-12-04 10:49:27 0:00        -         1     -   41Mb   
##  2232502 DONE example    3     2019-12-04 11:24:45 0:00        -         1     -   35Mb   
##  2232503 DONE example_1  3     2019-12-04 11:24:47 0:00        -         1     -   41Mb   
##  2232504 DONE example_2  3     2019-12-04 11:24:47 0:00        -         1     -   41Mb   
##  2232505 DONE example_3  3     2019-12-04 11:24:47 0:00        -         1     -   34Mb   
##  2232506 DONE example_4  3     2019-12-04 11:24:47 0:00        -         1     -   41Mb   
##  2272166 DONE example    2     2019-12-05 19:31:48 0:00        -         4     -   40Mb   
##  2272167 DONE example2   2     2019-12-05 19:31:48 0:00        -         1     -   42Mb   
##  2272169 DONE example_1  2     2019-12-05 19:32:30 0:00        -         1     -   6Mb    
##  2272170 DONE example_2  2     2019-12-05 19:32:30 0:00        -         1     -   6Mb    
##  2272171 DONE example_3  2     2019-12-05 19:32:30 0:00        -         1     -   6Mb    
##  2272172 DONE example_4  2     2019-12-05 19:32:31 0:00        -         1     -   6Mb    
##  2272228 DONE example    1     2019-12-05 19:43:46 0:00        -         4     -   39Mb   
##  2272229 DONE example2   1     2019-12-05 19:43:46 0:00        -         1     -   41Mb   
##  2272231 PEND example_1  1     2019-12-05 19:44:28 -           -         -     -   -      
##  2272232 PEND example_2  1     2019-12-05 19:44:28 -           -         -     -   -      
##  2272233 PEND example_3  1     2019-12-05 19:44:28 -           -         -     -   -      
##  2272234 PEND example_4  1     2019-12-05 19:44:28 -           -         -     -   -      
##  JOBID   STAT JOB_NAME  RECENT SUBMIT_TIME         TIME_PASSED TIME_LEFT SLOTS MEM MAX_MEM
## ========================================================================================== 
##  422 DONE jobs, 63 EXIT jobs, 4 PEND jobs, 42 RUN jobs within one week.
##  You can have more controls by `bjobs(status = ..., max = ..., filter = ...)`.</code></pre>
<p><code><a href="../reference/brecent.html">brecent()</a></code> returns 20 most recent jobs.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" data-line-number="1">brecent</a></code></pre></div>
<pre><code>## ================================================================================================ 
##  JOBID   STAT JOB_NAME        RECENT SUBMIT_TIME         TIME_PASSED TIME_LEFT SLOTS MEM MAX_MEM
##  2230248 DONE example2        3      2019-12-04 10:49:27 0:00        -         1     -   41Mb   
##  2232502 DONE example         3      2019-12-04 11:24:45 0:00        -         1     -   35Mb   
##  2232503 DONE example_1       3      2019-12-04 11:24:47 0:00        -         1     -   41Mb   
##  2232504 DONE example_2       3      2019-12-04 11:24:47 0:00        -         1     -   41Mb   
##  2232505 DONE example_3       3      2019-12-04 11:24:47 0:00        -         1     -   34Mb   
##  2232506 DONE example_4       3      2019-12-04 11:24:47 0:00        -         1     -   41Mb   
##  2272165 DONE R_code_c3481a47 2      2019-12-05 19:31:47 0:00        -         1     -   42Mb   
##  2272166 DONE example         2      2019-12-05 19:31:48 0:00        -         4     -   40Mb   
##  2272167 DONE example2        2      2019-12-05 19:31:48 0:00        -         1     -   42Mb   
##  2272169 DONE example_1       2      2019-12-05 19:32:30 0:00        -         1     -   6Mb    
##  2272170 DONE example_2       2      2019-12-05 19:32:30 0:00        -         1     -   6Mb    
##  2272171 DONE example_3       2      2019-12-05 19:32:30 0:00        -         1     -   6Mb    
##  2272172 DONE example_4       2      2019-12-05 19:32:31 0:00        -         1     -   6Mb    
##  2272227 DONE R_code_c3481a47 1      2019-12-05 19:43:46 0:00        -         1     -   41Mb   
##  2272228 DONE example         1      2019-12-05 19:43:46 0:00        -         4     -   39Mb   
##  2272229 DONE example2        1      2019-12-05 19:43:46 0:00        -         1     -   41Mb   
##  2272231 PEND example_1       1      2019-12-05 19:44:28 -           -         -     -   -      
##  2272232 PEND example_2       1      2019-12-05 19:44:28 -           -         -     -   -      
##  2272233 PEND example_3       1      2019-12-05 19:44:28 -           -         -     -   -      
##  2272234 PEND example_4       1      2019-12-05 19:44:28 -           -         -     -   -      
## ================================================================================================ 
##  422 DONE jobs, 63 EXIT jobs, 4 PEND jobs, 42 RUN jobs within one week.
##  You can have more controls by `bjobs(status = ..., max = ..., filter = ...)`.</code></pre>
</div>
<div id="on-other-clusters" class="section level2">
<h2 class="hasAnchor">
<a href="#on-other-clusters" class="anchor"></a>On other clusters</h2>
<p>The <strong>bsub</strong> package is only tested on DKFZ ODCF cluster. It is also possible for other clusters that use LSF system to use <strong>bsub</strong> package. Following global options should be properly configured:</p>
<ol style="list-style-type: decimal">
<li>How to call the <code>Rscript</code> binary, especially when you have different versions of R installed. Following is how we call <code>Rscript</code> on our cluster (we use <code>module</code> to manage the bash environment).</li>
</ol>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" data-line-number="1">bsub_opt<span class="op">$</span>call_Rscript =<span class="st"> </span><span class="cf">function</span>(version) <span class="kw"><a href="https://rdrr.io/pkg/GetoptLong/man/qq.html">qq</a></span>(<span class="st">"module load gcc/7.2.0; module load java/1.8.0_131; module load R/@{version}; Rscript"</span>)</a></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>The names of the nodes where the jobs are submitted.</li>
</ol>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" data-line-number="1">bsub_opt<span class="op">$</span>submission_node =<span class="st"> </span>...</a></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Bash environment. It is basically for finding <code>bsub</code>/<code>bjobs</code>/â€¦ Following is how we set up on our cluster.</li>
</ol>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" data-line-number="1">bsub_opt<span class="op">$</span>ssh_envir =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"source /etc/profile"</span>,</a>
<a class="sourceLine" id="cb57-2" data-line-number="2">                       <span class="st">"export LSF_ENVDIR=/opt/lsf/conf"</span>,</a>
<a class="sourceLine" id="cb57-3" data-line-number="3">                       <span class="st">"export LSF_SERVERDIR=/opt/lsf/10.1/linux3.10-glibc2.17-x86_64/etc"</span>)</a></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>The template of <code>bsub</code> command. The self-defined function should accepts following arguments:</li>
</ol>
<ul>
<li>
<code>name</code> job name.</li>
<li>
<code>hour</code> running time.</li>
<li>
<code>memory</code> memory, in GB.</li>
<li>
<code>core</code> number of cores to use.</li>
<li>
<code>output</code> path of output file</li>
</ul>
<p><code>...</code> should be added as the last argument of the function. Following is a simple example for calling <code>bsub</code>.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb58-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(glue)</a>
<a class="sourceLine" id="cb58-2" data-line-number="2">bsub_opt<span class="op">$</span>bsub_template =<span class="st"> </span><span class="cf">function</span>(name, hour, memory, core, output, ...) {</a>
<a class="sourceLine" id="cb58-3" data-line-number="3">    <span class="kw"><a href="https://rdrr.io/pkg/glue/man/glue.html">glue</a></span>(<span class="st">"bsub -J '{name}' -W '{hour}:00' -n {core} -R 'rusage[mem={memory}GB]' -o '{output}'"</span>)</a>
<a class="sourceLine" id="cb58-4" data-line-number="4">}</a></code></pre></div>
</div>
<div id="session-info" class="section level2">
<h2 class="hasAnchor">
<a href="#session-info" class="anchor"></a>Session Info</h2>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span>()</a></code></pre></div>
<pre><code>## R version 3.6.0 (2019-04-26)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: CentOS Linux 7 (Core)
## 
## Matrix products: default
## BLAS:   /usr/lib64/libblas.so.3.4.2
## LAPACK: /usr/lib64/liblapack.so.3.4.2
## 
## locale:
##  [1] LC_CTYPE=en_GB.UTF-8       LC_NUMERIC=C              
##  [3] LC_TIME=en_GB.UTF-8        LC_COLLATE=en_GB.UTF-8    
##  [5] LC_MONETARY=en_GB.UTF-8    LC_MESSAGES=en_GB.UTF-8   
##  [7] LC_PAPER=en_GB.UTF-8       LC_NAME=C                 
##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            
## [11] LC_MEASUREMENT=en_GB.UTF-8 LC_IDENTIFICATION=C       
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] GetoptLong_0.1.7 bsub_0.0.3      
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_1.0.3          rprojroot_1.3-2     crayon_1.3.4       
##  [4] digest_0.6.23       assertthat_0.2.1    MASS_7.3-51.4      
##  [7] R6_2.4.1            backports_1.1.5     magrittr_1.5       
## [10] evaluate_0.14       GlobalOptions_0.1.1 stringi_1.4.3      
## [13] rlang_0.4.2         fs_1.3.1            rmarkdown_1.17     
## [16] pkgdown_1.4.1       desc_1.2.0          rjson_0.2.20       
## [19] tools_3.6.0         stringr_1.4.0       xfun_0.11          
## [22] compiler_3.6.0      memoise_1.1.0       htmltools_0.4.0    
## [25] knitr_1.26</code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#send-r-coder-scriptsshell-commands-to-lsf-cluster">Send R code/R scripts/shell commands to LSF cluster</a><ul class="nav nav-pills nav-stacked">
<li><a href="#send-r-code">Send R code</a></li>
      <li><a href="#send-r-script">Send R script</a></li>
      <li><a href="#send-other-shell-commands">Send other shell commands</a></li>
      <li><a href="#global-parameters">Global Parameters</a></li>
      <li><a href="#other-functions">Other functions</a></li>
      <li><a href="#on-other-clusters">On other clusters</a></li>
      <li><a href="#session-info">Session Info</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Zuguang Gu.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
