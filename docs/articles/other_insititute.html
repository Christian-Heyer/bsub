<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Configure bsub package for other institutes using LSF â€¢ bsub</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Configure bsub package for other institutes using LSF">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bsub</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.99.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/bsub_intro.html">Send R code/R scripts/shell commands to LSF cluster</a>
    </li>
    <li>
      <a href="../articles/dkfz_odcf.html">Use bsub package on the DKFZ ODCF cluster</a>
    </li>
    <li>
      <a href="../articles/other_insititute.html">Configure bsub package for other institutes using LSF</a>
    </li>
    <li>
      <a href="../articles/two_ssh.html">What if you need to establish two ssh connections to reach the submission node</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jokergoo/bsub">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Configure bsub package for other institutes using LSF</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jokergoo/bsub/blob/master/vignettes/other_insititute.Rmd"><code>vignettes/other_insititute.Rmd</code></a></small>
      <div class="hidden name"><code>other_insititute.Rmd</code></div>

    </div>

    
    
<p><strong>Author</strong>: Zuguang Gu ( <a href="mailto:z.gu@dkfz.de">z.gu@dkfz.de</a> )</p>
<p><strong>Date</strong>: 2020-01-08</p>
<hr>
<p>The <strong>bsub</strong> package is only broadly tested on DKFZ ODCF cluster and the default configurations work fine there. It is also possible for other clusters that use LSF system to use <strong>bsub</strong> package. Following global options should be properly configured.</p>
<div id="how-to-call-rscript-binary" class="section level3">
<h3 class="hasAnchor">
<a href="#how-to-call-rscript-binary" class="anchor"></a>How to call Rscript binary</h3>
<p>You need to configure how to call the <code>Rscript</code> binary, especially when you have different versions of R installed. Following is how we call <code>Rscript</code> on our cluster (we use <code>module</code> to manage the bash environment).</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">bsub_opt<span class="op">$</span>call_Rscript =<span class="st"> </span><span class="cf">function</span>(version) <span class="kw">qq</span>(<span class="st">"module load gcc/7.2.0; module load java/1.8.0_131; module load R/@{version}; Rscript"</span>)</a></code></pre></div>
<p>Then the different version of <code>Rscript</code> can be switched by setting different <code>bsub_opt$R_version</code> option.</p>
</div>
<div id="submission-node" class="section level3">
<h3 class="hasAnchor">
<a href="#submission-node" class="anchor"></a>Submission node</h3>
<p>The names of the nodes where the jobs are submitted can be set by <code>bsub_opt$submission_node</code> option. The value can be a vector of node names. <strong>bsub</strong> will randomly select one to connect.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">bsub_opt<span class="op">$</span>submission_node =<span class="st"> </span>...</a></code></pre></div>
</div>
<div id="username-on-the-submission-node" class="section level3">
<h3 class="hasAnchor">
<a href="#username-on-the-submission-node" class="anchor"></a>Username on the submission node</h3>
<p>Your username on the submission node can be set by <code>bsub_opt$user</code>. The default value is <code>Sys.info()['user']</code>. If the username on the submission node is different, you need to explicitly set it.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">bsub_opt<span class="op">$</span>user =<span class="st"> </span>...</a></code></pre></div>
</div>
<div id="bash-environment" class="section level3">
<h3 class="hasAnchor">
<a href="#bash-environment" class="anchor"></a>Bash environment</h3>
<p><code>bsub_opt$ssh_envir</code> should be properly set so that LSF binaries such as <code>bsub</code> or <code>bjobs</code> can be properly found. There are some environment variables initialized when logging in the bash terminal while they are not initialized with the ssh connection. Thus, some environment variables should be manually set.</p>
<p>An example for <code>bsub_opt$ssh_envir</code> is as follows. The <code>LSF_ENVDIR</code> and <code>LSF_SERVERDIR</code> should be defined and exported.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">bsub_opt<span class="op">$</span>ssh_envir =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"source /etc/profile"</span>,</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">                       <span class="st">"export LSF_ENVDIR=/opt/lsf/conf"</span>,</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">                       <span class="st">"export LSF_SERVERDIR=/opt/lsf/10.1/linux3.10-glibc2.17-x86_64/etc"</span>)</a></code></pre></div>
<p>The values of these two variables can be obtained by entering following commands in your bash terminal (on the submission node):</p>
<pre><code>echo $LSF_ENVDIR
echo $LSF_SERVERDIR</code></pre>
</div>
<div id="bsub-template" class="section level3">
<h3 class="hasAnchor">
<a href="#bsub-template" class="anchor"></a>bsub template</h3>
<p>You need to define the template for calling the <code>bsub</code> command by <code>bsub_opt$bsub_template</code> option. The self-defined function should accepts following arguments:</p>
<ul>
<li>
<code>name</code> job name.</li>
<li>
<code>hour</code> running time.</li>
<li>
<code>memory</code> memory, in GB.</li>
<li>
<code>core</code> number of cores to use.</li>
<li>
<code>output</code> path of output file.</li>
<li>
<code>...</code> should be added as the last argument of the function. Following is a simple example for calling <code>bsub</code>.</li>
</ul>
<p>The temporary bash script to submit is automatically appended as the last argument of <code>bsub</code>.</p>
<p>E.g., the template on DKFZ ODCF is defined as:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">bsub_opt<span class="op">$</span>bsub_template =<span class="st"> </span><span class="cf">function</span>(name, hour, memory, core, output, ...) {</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">    glue<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/glue/man/glue.html">glue</a></span>(<span class="st">"bsub -J '{name}' -W '{hour}:00' -n {core} -R 'rusage[mem={memory}GB]' -o '{output}'"</span>)</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">}</a></code></pre></div>
<p>You can use <code><a href="https://rdrr.io/pkg/glue/man/glue.html">glue::glue()</a></code> or <code><a href="https://rdrr.io/pkg/GetoptLong/man/qq.html">GetoptLong::qq()</a></code> to construct a complex string with multiple variables.</p>
</div>
<div id="how-to-parse-the-time-strings" class="section level3">
<h3 class="hasAnchor">
<a href="#how-to-parse-the-time-strings" class="anchor"></a>How to parse the time strings</h3>
<p>The time strings by LSF <code>bjobs</code> command might be different for different configurations. The <strong>bsub</strong> package needs to convert the time strings to <code>POSIXlt</code> objects for calculating the time difference. Thus, if the default time string parsing fails, users need to provide a user-defined function and set with <code>bsub_opt$parse_time</code> option in <code>bsub_opt</code>. The function accepts a vector of time strings and returns a <code>POSIXlt</code> object. For example, if the time string returned from <code>bjobs</code> command is in a form of <code>Dec 1 18:00:00 2019</code>, the parsing function can be defined as:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">bsub_opt<span class="op">$</span>parse_time =<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">    <span class="kw"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXlt</a></span>(x, <span class="dt">format =</span> <span class="st">"%b %d %H:%M:%S %Y"</span>)</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">}</a></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Zuguang Gu.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
